{"AWSTemplateFormatVersion":"2010-09-09","Description":"S3 deployment for business TEST_BUSINESS with domain test-domain.simplu.io for business type dental","Parameters":{"BusinessId":{"Type":"String","Description":"Business ID"},"BusinessType":{"Type":"String","Description":"Business type (dental, gym, hotel)","AllowedValues":["dental","gym","hotel"]},"DomainLabel":{"Type":"String","Description":"Domain label for the business"},"BaseDomain":{"Type":"String","Description":"Base domain (e.g., simplu.io)","Default":"simplu.io"}},"Resources":{"S3Bucket":{"Type":"AWS::S3::Bucket","Properties":{"BucketName":{"Fn::Sub":"${DomainLabel}.${BaseDomain}"},"WebsiteConfiguration":{"IndexDocument":"index.html","ErrorDocument":"index.html"}}},"S3BucketPolicy":{"Type":"AWS::S3::BucketPolicy","Properties":{"Bucket":{"Ref":"S3Bucket"},"PolicyDocument":{"Statement":[{"Sid":"PublicReadGetObject","Effect":"Allow","Principal":"*","Action":"s3:GetObject","Resource":{"Fn::Sub":"${S3Bucket}/*"}}]}}},"CloudFrontDistribution":{"Type":"AWS::CloudFront::Distribution","Properties":{"DistributionConfig":{"Origins":[{"Id":"S3Origin","DomainName":{"Fn::GetAtt":["S3Bucket","DomainName"]},"CustomOriginConfig":{"HTTPPort":80,"HTTPSPort":443,"OriginProtocolPolicy":"http-only"}}],"DefaultCacheBehavior":{"TargetOriginId":"S3Origin","ViewerProtocolPolicy":"redirect-to-https","AllowedMethods":["GET","HEAD","OPTIONS"],"CachedMethods":["GET","HEAD"],"Compress":true,"ForwardedValues":{"QueryString":false,"Cookies":{"Forward":"none"}},"DefaultTTL":0,"MaxTTL":31536000,"MinTTL":0},"CacheBehaviors":[{"PathPattern":"/static/*","TargetOriginId":"S3Origin","ViewerProtocolPolicy":"redirect-to-https","AllowedMethods":["GET","HEAD"],"CachedMethods":["GET","HEAD"],"Compress":true,"ForwardedValues":{"QueryString":false,"Cookies":{"Forward":"none"}},"DefaultTTL":86400,"MaxTTL":31536000,"MinTTL":0},{"PathPattern":"*.js","TargetOriginId":"S3Origin","ViewerProtocolPolicy":"redirect-to-https","AllowedMethods":["GET","HEAD"],"CachedMethods":["GET","HEAD"],"Compress":true,"ForwardedValues":{"QueryString":false,"Cookies":{"Forward":"none"}},"DefaultTTL":86400,"MaxTTL":31536000,"MinTTL":0},{"PathPattern":"*.css","TargetOriginId":"S3Origin","ViewerProtocolPolicy":"redirect-to-https","AllowedMethods":["GET","HEAD"],"CachedMethods":["GET","HEAD"],"Compress":true,"ForwardedValues":{"QueryString":false,"Cookies":{"Forward":"none"}},"DefaultTTL":86400,"MaxTTL":31536000,"MinTTL":0}],"Enabled":true,"DefaultRootObject":"index.html","CustomErrorResponses":[{"ErrorCode":404,"ResponseCode":200,"ResponsePagePath":"/index.html"},{"ErrorCode":403,"ResponseCode":200,"ResponsePagePath":"/index.html"}],"PriceClass":"PriceClass_100","ViewerCertificate":{"CloudFrontDefaultCertificate":true},"HttpVersion":"http2","Comment":{"Fn::Sub":"CloudFront distribution for ${BusinessId}"}}}}},"Outputs":{"BucketName":{"Description":"Name of the S3 bucket","Value":{"Ref":"S3Bucket"},"Export":{"Name":{"Fn::Sub":"${AWS::StackName}-BucketName"}}},"CloudFrontDomain":{"Description":"CloudFront distribution domain","Value":{"Fn::GetAtt":["CloudFrontDistribution","DomainName"]},"Export":{"Name":{"Fn::Sub":"${AWS::StackName}-CloudFrontDomain"}}},"AppUrl":{"Description":"URL of the business client app","Value":{"Fn::Sub":"https://${DomainLabel}.${BaseDomain}"},"Export":{"Name":{"Fn::Sub":"${AWS::StackName}-AppUrl"}}},"DistributionId":{"Description":"CloudFront distribution ID","Value":{"Ref":"CloudFrontDistribution"},"Export":{"Name":{"Fn::Sub":"${AWS::StackName}-DistributionId"}}}}}